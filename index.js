const Discord = require("discord.js");
const { EmbedBuilder,MessageEmbed } = require("discord.js")
const fs = require("fs");
const db = require('croxydb')
const config = require("./config.json");
const functions = require('./function/functions');
const Rest = require("@discordjs/rest");
const DiscordApi = require("discord-api-types/v10");

const client = new Discord.Client({
	intents:  3276543,
    partials: Object.values(Discord.Partials),
	allowedMentions: {
		parse: ["users", "roles", "everyone"]
	},
	retryLimit: 3
});

global.client = client;
client.commands = (global.commands = []);

//
console.log(`[-] ${fs.readdirSync("./commands").length} komut algÄ±landÄ±.`)

for(let commandName of fs.readdirSync("./commands")) {
	if(!commandName.endsWith(".js")) return;

	const command = require(`./commands/${commandName}`);	
	client.commands.push({
		name: command.name.toLowerCase(),
		description: command.description.toLowerCase(),
		options: command.options,
		dm_permission: false,
		type: 1
	});

	console.log(`[+] ${commandName} komutu baÅŸarÄ±yla yÃ¼klendi.`)
}

client.on('messageCreate', msg => { 
	
	if (msg.content === `<@${config["bot-id"]}>`) {
        msg.reply('Birisi Beni Ã‡aÄŸÄ±rdÄ± SanÄ±rÄ±m KomutlarÄ±ma `/yardÄ±m` ile bakabilirsin  ğŸ’•');
    }
	
  });
  client.on('messageCreate', msg => {
    const content = msg.content.toLowerCase(); 

    const replies = {
        'sa': 'aleykÃ¼m selam deÄŸerli insan ğŸ˜‹',
        'naber': 'iyilik yuvarlanÄ±p gidiyoruz senden naber ğŸ˜ƒ',
        'sea': 'aleykÃ¼m selam deÄŸerli insan ğŸ˜‹',
        'selam': 'aleykÃ¼m selam deÄŸerli insan ğŸ˜‹',
        'selamun aleykÃ¼m': 'aleykÃ¼m selam deÄŸerli insan ğŸ˜‹',
		'selamÄ±n aleykÃ¼m': 'aleykÃ¼m selam deÄŸerli insan ğŸ˜‹',
        'selamunaleykÃ¼m': 'aleykÃ¼m selam deÄŸerli insan ğŸ˜‹',
		'meriÃ§ abi': 'adamÄ± bi salÄ±n bea ÅŸuan kendisi meÅŸgul ğŸ˜‹',
		'meriÃ§ abÄ±': 'adamÄ± bi salÄ±n bea ÅŸuan kendisi meÅŸgul ğŸ˜‹',
		'meric abÄ±': 'adamÄ± bi salÄ±n bea ÅŸuan kendisi meÅŸgul ğŸ˜‹',
		'meriÃ§abi': 'adamÄ± bi salÄ±n bea ÅŸuan kendisi meÅŸgul ğŸ˜‹',
		'MeriÃ§ abi': 'adamÄ± bi salÄ±n bea ÅŸuan kendisi meÅŸgul ğŸ˜‹',
		'meriÃ§': 'adamÄ± bi salÄ±n bea ÅŸuan kendisi meÅŸgul ğŸ˜‹',
		'ÅŸÃ¼krÃ¼': 'jukrÃ¼ jukrÃ¼ adÄ±mÄ± mÄ± ezberlersiniz beya ğŸ˜‹',
		'sÃ¼krÃ¼': 'jukrÃ¼ jukrÃ¼ adÄ±mÄ± mÄ± ezberlersiniz beya ğŸ˜‹',
		'ÅŸukru': 'jukrÃ¼ jukrÃ¼ adÄ±mÄ± mÄ± ezberlersiniz beya ğŸ˜‹',
		'gel': 'nereye geleyim beya susak ğŸ˜‹',
		'acil': 'Acilse 112yi arasana beya ğŸ˜‹',
		'volkan abi': 'yine mi kavga ediyorsunuz? ',
		'nerdesin abi': 'dur rahatsÄ±z etme iÅŸ Ã¼zerindeyim ğŸ˜‹',
		'nerdesin': 'dur rahatsÄ±z etme iÅŸ Ã¼zerindeyim ğŸ˜‹',
		'gunaydÄ±n': 'gÃ¼naydÄ±n deÄŸerli insan bu saatte mi kalkÄ±lÄ±r ğŸ˜‹',
		'gÃ¼naydÄ±n': 'gÃ¼naydÄ±n deÄŸerli insan bu saatte mi kalkÄ±lÄ±r ğŸ˜‹',
        'selamunaleykum': 'aleykÃ¼m selam deÄŸerli insan ğŸ˜‹'
    };
		if (replies[content]) {
			msg.reply(replies[content]);
		}
	});
// 

console.log(`[-] ${fs.readdirSync("./events").length} olay algÄ±landÄ±.`)

for(let eventName of fs.readdirSync("./events")) {
	if(!eventName.endsWith(".js")) return;

	const event = require(`./events/${eventName}`);	
	const evenet_name = eventName.split(".")[0];

	client.on(event.name, (...args) => {
		event.run(client, ...args)
	});

	console.log(`[+] ${eventName} olayÄ± baÅŸarÄ±yla yÃ¼klendi.`)
}



client.once("ready", async() => {
	const rest = new Rest.REST({ version: "10" }).setToken(process.env.token);
  try {
    await rest.put(DiscordApi.Routes.applicationCommands(client.user.id), {
      body: client.commands,  //
    });
	
	console.log(`${client.user.tag} Aktif! ğŸ’•`);
	db.set("botAcilis_", Date.now());

  } catch (error) {
    throw error;
  }
});

client.login(process.env.token).then(() => {
	console.log(`[-] Discord API'ye istek gÃ¶nderiliyor.`);
	eval("console.clear()")
}).catch(() => {
	console.log(`[x] Discord API'ye istek gÃ¶nderimi baÅŸarÄ±sÄ±z(token girmeyi unutmuÅŸsun).`);
});    

//Aktiflik saÄŸlama
const express = require('express');
const app = express();
const port = 3000;

app.get('/', (req, res) => {
  res.sendStatus(200);
});

app.listen(port, () => {
  console.log('Sunucu ${port} numaralÄ± baÄŸlantÄ± noktasÄ±nda yÃ¼rÃ¼tÃ¼lÃ¼yor.');
});
